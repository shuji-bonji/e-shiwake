# e-shiwake（電子仕訳）

フリーランス・個人事業主向けの仕訳帳 + 証憑管理 PWAアプリ

個人事業主になったので、自身が必要に迫られて作りました。=°ω°=

## 特徴

- **ローカルファースト**: サーバー不要、IndexedDB にデータ保存
- **電帳法対応**: 日本の電子帳簿保存法の検索要件を満たす
- **証憑管理**: PDF を仕訳に紐付け、自動リネームして保存
- **PWA**: オフライン動作、インストール可能
- **複合仕訳対応**: 家事按分・源泉徴収など複数行の仕訳に対応
- **全年度横断検索**: 摘要、取引先、勘定科目、金額、日付で検索可能

## ターゲットユーザー

- 日本のフリーランス・個人事業主
- 確定申告を自分で行う人
- クラウド会計の月額課金を避けたい人

## 技術スタック

- **フレームワーク**: SvelteKit 2 + Svelte 5
- **言語**: TypeScript
- **UI**: shadcn-svelte + Tailwind CSS v4
- **データ保存**: IndexedDB（Dexie.js）
- **ファイル操作**: File System Access API（デスクトップ）
- **PWA**: Service Worker + Web App Manifest
- **テスト**: Vitest

## セットアップ

```sh
# 依存関係のインストール
npm install

# 開発サーバーの起動
npm run dev

# ブラウザで自動的に開く場合
npm run dev -- --open
```

## スクリプト

```sh
# 開発サーバー
npm run dev

# ビルド
npm run build

# ビルドのプレビュー
npm run preview

# 型チェック
npm run check

# Lint
npm run lint

# ユニットテスト
npm test

# テスト（ウォッチモード）
npm run test:unit
```

## 機能

### 実装済み（Phase 1: MVP + Phase 1.5: PWA & UX強化）

- サイドバーレイアウト
- 年度管理（選択 / フィルタリング）
- 仕訳 CRUD（複合仕訳対応、インライン編集）
- 消費税区分（課税売上/仕入 10%/8%、非課税、不課税、対象外）
- 勘定科目マスタ（初期データ込み）
- 勘定科目管理ページ（追加/編集/削除）
- 取引先オートコンプリート
- PDF 紐付け + 自動リネーム
- 証跡ステータス管理
- IndexedDB 保存
- JSON / CSV エクスポート
- 証憑ダウンロード（IndexedDB モード）
- JSON インポート
- 年度データ削除（2段階確認）
- ダークモード対応
- PWA 対応（オフライン動作、インストール可能）
- ストレージモード切替（ローカルフォルダ / ブラウザ保存）
- 証憑マイグレーション機能
- 完全バックアップ（ZIP: JSON + PDF）
- ZIPインポート（証憑復元対応）
- 仕訳検索（全年度横断、複数条件AND検索）
- 仕訳コピー機能

### 今後の予定

**Phase 2: 帳簿機能**

- 総勘定元帳
- 試算表

**Phase 3: 確定申告対応（有料オプション）**

- 損益計算書
- 貸借対照表
- 青色申告決算書生成

## 電帳法対応

### 検索要件（必須 3 項目）

1. **取引年月日**: 仕訳の日付フィールド
2. **取引金額**: 借方/貸方金額
3. **取引先名**: 取引先フィールド

### ファイル命名規則

証憑ファイルは以下の形式で自動リネームされます。

```
{書類の日付}_{種類}_{摘要}_{金額}円_{取引先名}.pdf
```

例：

```
2024-01-15_領収書_USBケーブル購入_3,980円_Amazon.pdf
2024-01-15_請求書発行_システム開発_100,000円_クライアントA.pdf
```

## 仕訳検索

仕訳帳画面の検索ボックスから、**全年度を対象に**仕訳を検索できます。

### 検索できる項目

| 入力例 | 検索対象 | 説明 |
|--------|----------|------|
| `Amazon` | 摘要・取引先 | テキスト部分一致 |
| `消耗品費` | 勘定科目 | 科目名の前方一致 |
| `10000` | 金額 | 完全一致 |
| `10,000` | 金額 | カンマ付き金額も可 |
| `2025-01` | 年月 | その月の仕訳を表示 |
| `12月` | 月 | 全年度の12月の仕訳 |
| `2025-01-15` | 日付 | 特定の日付 |
| `10/13` | 月日 | 全年度の10月13日の仕訳 |

### 複数条件の検索（AND検索）

スペースで区切って複数の条件を入力すると、すべてに一致する仕訳が表示されます。

- `Amazon 12月` → Amazonの12月の仕訳
- `消耗品費 10000` → 消耗品費で1万円の仕訳

## データ保存

### デスクトップ（Chrome, Edge）

File System Access API を使用して、ユーザーが選択したディレクトリに直接保存。

### iPad / モバイル

IndexedDB に Blob として保存。定期的なエクスポートを推奨。

## 開発者向け

詳細な仕様については `CLAUDE.md` を参照してください。

### ファイル構成

```
src/
├── lib/
│   ├── components/     # 再利用可能なコンポーネント
│   │   ├── ui/         # shadcn-svelte コンポーネント
│   │   ├── layout/     # レイアウトコンポーネント
│   │   └── journal/    # 仕訳関連コンポーネント
│   ├── adapters/       # 外部依存の抽象化層
│   ├── usecases/       # ビジネスロジック
│   ├── stores/         # Svelte stores
│   ├── db/             # IndexedDB 関連（Dexie）
│   ├── types/          # TypeScript 型定義
│   └── utils/          # ユーティリティ関数
├── routes/
│   ├── +layout.svelte        # サイドバーレイアウト
│   ├── +page.svelte          # 仕訳帳（ホーム）
│   ├── accounts/             # 勘定科目管理
│   ├── settings/             # 設定
│   └── data/                 # データ管理（エクスポート/インポート/削除）
```

## ライセンス

MIT
